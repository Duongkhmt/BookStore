<!--<!DOCTYPE html>-->
<!--<html lang="vi">-->
<!--<head>-->
<!--    <meta charset="UTF-8" />-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--    <title>ÄÄƒng kÃ½ - BookStore</title>-->
<!--    <link rel="stylesheet" href="/css/styles.css" />-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">-->
<!--</head>-->
<!--<body>-->
<!--<div class="topbar">-->
<!--    <div class="topbar-content">-->
<!--        <a href="/" class="brand">ğŸ“š BookStore</a>-->
<!--    </div>-->
<!--</div>-->

<!--<div class="container">-->
<!--    <div class="grid grid-cols-1" style="max-width: 400px; margin: 4rem auto;">-->
<!--        <div class="card">-->
<!--            <div class="card-header text-center">-->
<!--                <h1 class="card-title">Táº¡o tÃ i khoáº£n</h1>-->
<!--                <p class="card-subtitle">Tham gia cá»™ng Ä‘á»“ng BookStore</p>-->
<!--            </div>-->
<!--            <div class="card-body">-->
<!--                <form onsubmit="register(event)" id="registerForm">-->
<!--                    <div class="form-group">-->
<!--                        <label for="username" class="form-label">TÃªn Ä‘Äƒng nháº­p *</label>-->
<!--                        <input-->
<!--                                type="text"-->
<!--                                id="username"-->
<!--                                class="form-control"-->
<!--                                placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"-->
<!--                                required-->
<!--                        />-->
<!--                    </div>-->

<!--                    <div class="form-group">-->
<!--                        <label for="email" class="form-label">Email *</label>-->
<!--                        <input-->
<!--                                type="email"-->
<!--                                id="email"-->
<!--                                class="form-control"-->
<!--                                placeholder="Nháº­p email"-->
<!--                                required-->
<!--                        />-->
<!--                    </div>-->

<!--                    <div class="form-group">-->
<!--                        <label for="password" class="form-label">Máº­t kháº©u *</label>-->
<!--                        <input-->
<!--                                type="password"-->
<!--                                id="password"-->
<!--                                class="form-control"-->
<!--                                placeholder="Nháº­p máº­t kháº©u"-->
<!--                                required-->
<!--                        />-->
<!--                    </div>-->

<!--                    <div class="form-group">-->
<!--                        <label for="confirmPassword" class="form-label">XÃ¡c nháº­n máº­t kháº©u *</label>-->
<!--                        <input-->
<!--                                type="password"-->
<!--                                id="confirmPassword"-->
<!--                                class="form-control"-->
<!--                                placeholder="Nháº­p láº¡i máº­t kháº©u"-->
<!--                                required-->
<!--                        />-->
<!--                    </div>-->

<!--                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">-->
<!--                        <span id="registerText">ÄÄƒng kÃ½</span>-->
<!--                        <div id="registerLoading" class="loading" style="display: none;"></div>-->
<!--                    </button>-->
<!--                </form>-->

<!--                <div id="message" class="mt-2"></div>-->

<!--                <p class="text-center mt-2" style="color: #64748b; font-size: 0.875rem;">-->
<!--                    ÄÃ£ cÃ³ tÃ i khoáº£n?-->
<!--                    <a href="/login" style="color: #3b82f6; text-decoration: none;">ÄÄƒng nháº­p ngay</a>-->
<!--                </p>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<script>-->
<!--    async function register(e) {-->
<!--        e.preventDefault();-->

<!--        const registerText = document.getElementById('registerText');-->
<!--        const registerLoading = document.getElementById('registerLoading');-->
<!--        const messageDiv = document.getElementById('message');-->
<!--        const form = document.getElementById('registerForm');-->

<!--        const password = document.getElementById('password').value;-->
<!--        const confirmPassword = document.getElementById('confirmPassword').value;-->

<!--        // XÃ³a thÃ´ng bÃ¡o lá»—i cÅ©-->
<!--        messageDiv.innerHTML = '';-->

<!--        // 1. Kiá»ƒm tra máº­t kháº©u khá»›p-->
<!--        if (password !== confirmPassword) {-->
<!--            messageDiv.innerHTML = '<div class="alert alert-error">Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!</div>';-->
<!--            return;-->
<!--        }-->

<!--        // 2. Hiá»ƒn thá»‹ loading-->
<!--        registerText.style.display = 'none';-->
<!--        registerLoading.style.display = 'inline-block';-->

<!--        // 3. Chuáº©n bá»‹ payload-->
<!--        const payload = {-->
<!--            username: document.getElementById('username').value.trim(),-->
<!--            email: document.getElementById('email').value.trim(),-->
<!--            password: password,-->
<!--            role: 'ROLE_USER' // Máº·c Ä‘á»‹nh lÃ  USER-->
<!--        };-->

<!--        try {-->
<!--            // 4. Gá»i API (Giáº£ sá»­ báº¡n cÃ³ file api.js)-->
<!--            // Náº¿u khÃ´ng cÃ³ API class, dÃ¹ng fetch-->
<!--            const res = await fetch('/api/auth/register', {-->
<!--                method: 'POST',-->
<!--                headers: {'Content-Type': 'application/json'},-->
<!--                body: JSON.stringify(payload)-->
<!--            });-->

<!--            const json = await res.json();-->

<!--            if (res.ok) {-->
<!--                // 5. ThÃ nh cÃ´ng-->
<!--                messageDiv.innerHTML = '<div class="alert alert-success">ÄÄƒng kÃ½ thÃ nh cÃ´ng! Äang chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang Ä‘Äƒng nháº­p...</div>';-->

<!--                setTimeout(() => {-->
<!--                    window.location.href = '/login';-->
<!--                }, 2000);-->

<!--            } else {-->
<!--                // 6. Tháº¥t báº¡i-->
<!--                messageDiv.innerHTML = `<div class="alert alert-error">${json?.message || 'ÄÄƒng kÃ½ tháº¥t báº¡i'}</div>`;-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('Register error:', error);-->
<!--            messageDiv.innerHTML = '<div class="alert alert-error">Lá»—i káº¿t ná»‘i Ä‘áº¿n mÃ¡y chá»§</div>';-->
<!--        } finally {-->
<!--            // 7. áº¨n loading-->
<!--            registerText.style.display = 'inline-block';-->
<!--            registerLoading.style.display = 'none';-->
<!--        }-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÄÄƒng kÃ½ - BookStore</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="topbar">
    <div class="topbar-content">
        <a href="/" class="brand">ğŸ“š BookStore</a>
    </div>
</div>

<div class="container">
    <div class="grid grid-cols-1" style="max-width: 400px; margin: 4rem auto;">
        <div class="card">
            <div class="card-header text-center">
                <h1 class="card-title">Táº¡o tÃ i khoáº£n</h1>
                <p class="card-subtitle">Tham gia cá»™ng Ä‘á»“ng BookStore</p>
            </div>
            <div class="card-body">
                <form onsubmit="register(event)" id="registerForm">
                    <div class="form-group">
                        <label for="username" class="form-label">TÃªn Ä‘Äƒng nháº­p *</label>
                        <input
                                type="text"
                                id="username"
                                class="form-control"
                                placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
                                required
                        />
                    </div>

                    <div class="form-group">
                        <label for="email" class="form-label">Email *</label>
                        <input
                                type="email"
                                id="email"
                                class="form-control"
                                placeholder="Nháº­p email"
                                required
                        />
                    </div>

                    <div class="form-group">
                        <label for="phoneNumber" class="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i *</label>
                        <input
                                type="text"
                                id="phoneNumber"
                                class="form-control"
                                placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"
                                required
                        />
                    </div>

                    <div class="form-group">
                        <label for="address" class="form-label">Äá»‹a chá»‰ *</label>
                        <input
                                type="text"
                                id="address"
                                class="form-control"
                                placeholder="Nháº­p Ä‘á»‹a chá»‰"
                                required
                        />
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label">Máº­t kháº©u *</label>
                        <input
                                type="password"
                                id="password"
                                class="form-control"
                                placeholder="Nháº­p máº­t kháº©u"
                                required
                        />
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">XÃ¡c nháº­n máº­t kháº©u *</label>
                        <input
                                type="password"
                                id="confirmPassword"
                                class="form-control"
                                placeholder="Nháº­p láº¡i máº­t kháº©u"
                                required
                        />
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                        <span id="registerText">ÄÄƒng kÃ½</span>
                        <div id="registerLoading" class="loading" style="display: none;"></div>
                    </button>
                </form>

                <div id="message" class="mt-2"></div>

                <p class="text-center mt-2" style="color: #64748b; font-size: 0.875rem;">
                    ÄÃ£ cÃ³ tÃ i khoáº£n?
                    <a href="/login" style="color: #3b82f6; text-decoration: none;">ÄÄƒng nháº­p ngay</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    async function register(e) {
        e.preventDefault();

        const registerText = document.getElementById('registerText');
        const registerLoading = document.getElementById('registerLoading');
        const messageDiv = document.getElementById('message');

        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // XÃ³a thÃ´ng bÃ¡o lá»—i cÅ©
        messageDiv.innerHTML = '';

        // 1. Kiá»ƒm tra máº­t kháº©u khá»›p
        if (password !== confirmPassword) {
            messageDiv.innerHTML = '<div class="alert alert-error">Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!</div>';
            return;
        }

        // 2. Hiá»ƒn thá»‹ loading
        registerText.style.display = 'none';
        registerLoading.style.display = 'inline-block';

        // 3. Chuáº©n bá»‹ payload (ÄÃ£ thÃªm address vÃ  phoneNumber)
        const payload = {
            username: document.getElementById('username').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: password,
            // --- THÃŠM Dá»® LIá»†U Má»šI ---
            address: document.getElementById('address').value.trim(),
            phoneNumber: document.getElementById('phoneNumber').value.trim(),
            // ------------------------
            role: 'ROLE_USER'
        };

        try {
            const res = await fetch('/api/auth/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            const json = await res.json();

            if (res.ok) {
                // 5. ThÃ nh cÃ´ng
                messageDiv.innerHTML = '<div class="alert alert-success">ÄÄƒng kÃ½ thÃ nh cÃ´ng! Äang chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang Ä‘Äƒng nháº­p...</div>';

                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);

            } else {
                // 6. Tháº¥t báº¡i (Láº¥y message tá»« backend)
                messageDiv.innerHTML = `<div class="alert alert-error">${json?.message || 'ÄÄƒng kÃ½ tháº¥t báº¡i'}</div>`;
            }
        } catch (error) {
            console.error('Register error:', error);
            messageDiv.innerHTML = '<div class="alert alert-error">Lá»—i káº¿t ná»‘i Ä‘áº¿n mÃ¡y chá»§</div>';
        } finally {
            // 7. áº¨n loading
            registerText.style.display = 'inline-block';
            registerLoading.style.display = 'none';
        }
    }
</script>
</body>
</html>