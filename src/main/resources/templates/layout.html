<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${pageTitle} ?: 'Bookstore'">Bookstore</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<!--<header class="topbar">-->
<!--    <div class="topbar-content">-->
<!--        <a href="/" class="brand">ğŸ“š BookStore</a>-->
<!--        <nav class="nav">-->
<!--            <a href="/catalog">SÃ¡ch</a>-->
<!--            <a href="/orders">ÄÆ¡n hÃ ng</a>-->
<!--            <a href="/admin">Quáº£n lÃ½</a>-->
<!--            &lt;!&ndash; ThÃªm giá» hÃ ng vá»›i badge &ndash;&gt;-->
<!--            <a href="/cart" class="cart-link">-->
<!--                ğŸ›’ Giá» hÃ ng-->
<!--                <span id="cartBadge" class="cart-badge" style="display: none;">0</span>-->
<!--            </a>-->
<!--            <a href="/login" id="loginLink" class="btn btn-outline">ÄÄƒng nháº­p</a>-->
<!--            <button id="logoutBtn" class="btn btn-danger" style="display:none">ÄÄƒng xuáº¥t</button>-->
<!--        </nav>-->
<!--    </div>-->
<!--</header>-->
<header class="topbar">
    <div class="topbar-content">
        <a href="/" class="brand">ğŸ“š BookStore</a>
        <nav class="nav" id="mainNav">
            <!-- Menu sáº½ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»™ng dá»±a trÃªn role -->
        </nav>
        <a href="/login" id="loginLink" class="btn btn-outline">ÄÄƒng nháº­p</a>
        <button id="logoutBtn" class="btn btn-danger" style="display:none">ÄÄƒng xuáº¥t</button>
    </div>
</header>

<main layout:fragment="content">
    <!-- Ná»™i dung tá»«ng trang con sáº½ Ä‘Æ°á»£c Thymeleaf thay tháº¿ vÃ o Ä‘Ã¢y -->
</main>
<script th:src="@{/js/cart-logic.js}"></script>
<script th:src="@{/js/auth.js}"></script>
<script th:src="@{/js/api.js}"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        const hasToken = !!localStorage.getItem('token');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginLink = document.getElementById('loginLink');
        const mainNav = document.getElementById('mainNav');

        // Láº¥y role
        const userRole = getUserRole ? getUserRole() : null;
        console.log('ğŸ¯ Current role:', userRole);

        // Cáº­p nháº­t menu dá»±a trÃªn role
        if (mainNav) {
            if (userRole === 'ADMIN') {
                // Menu cho ADMIN - CHá»ˆ cÃ³ admin
                mainNav.innerHTML = `
                    <a href="/admin">Quáº£n trá»‹ há»‡ thá»‘ng</a>
                `;
            } else if (userRole === 'USER') {
                // Menu cho USER - CHá»ˆ cÃ³ user pages
                mainNav.innerHTML = `
                    <a href="/catalog">SÃ¡ch</a>
                    <a href="/orders">ÄÆ¡n hÃ ng</a>
                    <a href="/cart" class="cart-link">
                        ğŸ›’ Giá» hÃ ng
                        <span id="cartBadge" class="cart-badge" style="display: none;">0</span>
                    </a>
                `;
            } else {
                // ChÆ°a Ä‘Äƒng nháº­p
                mainNav.innerHTML = `
                    <a href="/catalog">SÃ¡ch</a>
                `;
            }
        }

        if (logoutBtn) {
            logoutBtn.style.display = hasToken ? 'inline-block' : 'none';
            logoutBtn.onclick = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('cart');
                window.location.href = '/login';
            };
        }

        if (loginLink) {
            loginLink.style.display = hasToken ? 'none' : 'inline-block';
        }
    });
</script>
<th:block layout:fragment="script"></th:block>
</body>
</html>